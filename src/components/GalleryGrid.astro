---
import fs from 'fs';
import path from 'path';

const galleryDir = path.join(process.cwd(), 'public/gallery');
const files = fs.readdirSync(galleryDir)
  .filter(f => /\.(jpe?g|png|gif|webp|avif)$/i.test(f))
  .sort();

const images = files.map(f => `/gallery/${f}`);
---

<div class="container my-5">
  <div class="row g-4">
    {images.map((src, i) => (
      <div class="col-6 col-md-4 col-lg-3">
        <div class="card border-0 shadow-sm h-100 overflow-hidden">
          <a
            href="#"
            class="text-decoration-none d-block thumb-wrapper"
            data-bs-toggle="modal"
            data-bs-target="#imageModal"
            data-bs-image={src}
          >
            <img src={src} alt={src.split('/').pop()} class="img-thumb" loading="lazy" />
          </a>
        </div>
      </div>
    ))}
  </div>
</div>

<!-- Modal -->
<div
  class="modal fade"
  id="imageModal"
  tabindex="-1"
  aria-labelledby="imageModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content bg-dark border-0">
      <div class="modal-body p-0">
        <img id="modalImage" src="" alt="Full-size image" class="img-fluid rounded" />
      </div>
      <div class="modal-footer bg-dark border-0 justify-content-center">
        <button
          type="button"
          class="btn btn-red"
          data-bs-dismiss="modal"
          aria-label="Close"
        >
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<style>
  .thumb-wrapper {
    position: relative;
    width: 100%;
    aspect-ratio: 4/3;
    overflow: hidden;
    border-radius: 0.5rem;
  }

  .img-thumb {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.2s ease-in-out;
  }

  .img-thumb:hover {
    transform: scale(1.05);
  }

  /* Make modal image fit nicely */
  #modalImage {
    width: 100%;
    height: auto;
  }
</style>

<script is:inline>
  // Bootstrap modal image handler
  document.addEventListener('click', (event) => {
    const link = event.target.closest('[data-bs-toggle="modal"][data-bs-image]');
    if (!link) return;

    const imgSrc = link.getAttribute('data-bs-image');
    const modalImg = document.getElementById('modalImage');
    if (modalImg) modalImg.src = imgSrc;
  });
</script>
